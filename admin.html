<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel | RITEEK</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Segoe UI',sans-serif;
}
body{
  background:#0f0f14;
  color:#fff;
}

/* HEADER */
.header{
  background:#ff0057;
  padding:16px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}

/* LOGIN BOX */
.login{
  margin:30px;
  background:#1c1c28;
  padding:20px;
  border-radius:16px;
}
.login h3{margin-bottom:10px;}
.login input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  margin-bottom:10px;
}
.login button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:14px;
  background:#7a00ff;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

/* PANEL */
.panel{
  display:none;
  margin:20px;
}
.card{
  background:#26263a;
  padding:14px;
  border-radius:12px;
  margin-bottom:12px;
}
.card b{color:#00e5ff;}
.btns{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.approve{
  flex:1;
  background:#00c853;
  padding:10px;
  border-radius:10px;
  text-align:center;
  cursor:pointer;
}
.reject{
  flex:1;
  background:#ff1744;
  padding:10px;
  border-radius:10px;
  text-align:center;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="header">ADMIN PANEL – RITEEK</div>

<!-- LOGIN -->
<div class="login" id="loginBox">
  <h3>Admin Login</h3>
  <input type="password" id="pin" placeholder="Enter Admin PIN">
  <button onclick="adminLogin()">Login</button>
</div>

<!-- PANEL -->
<div class="panel" id="adminPanel">
  <h3>Pending Payments</h3>
  <div id="paymentList"></div>
</div>

<script>
/* ================= FIREBASE CONFIG (FINAL) ================= */
const firebaseConfig = {
  apiKey: "AIzaSyD9AuI0WpI8mT6GNd8ayvgAjnc4oPznbOI",
  authDomain: "riteek-x-official.firebaseapp.com",
  projectId: "riteek-x-official",
  storageBucket: "riteek-x-official.appspot.com",
  messagingSenderId: "1009762184094",
  appId: "1:1009762184094:web:d0a01b58c8f51bfe50048f"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= ADMIN PIN ================= */
const ADMIN_PIN = "Rrupesh@@8224";

/* ================= LOGIN ================= */
function adminLogin(){
  const enteredPin = document.getElementById("pin").value.trim();

  if(enteredPin === ADMIN_PIN){
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
    loadPayments();
  }else{
    alert("Wrong PIN");
  }
}

/* ================= LOAD PAYMENTS ================= */
function loadPayments(){
  db.collection("payments")
    .where("status","==","pending")
    .orderBy("time","desc")
    .onSnapshot(snapshot=>{
      const list = document.getElementById("paymentList");
      list.innerHTML = "";

      if(snapshot.empty){
        list.innerHTML = "<p>No pending payments</p>";
        return;
      }

      snapshot.forEach(doc=>{
        const d = doc.data();
        list.innerHTML += `
          <div class="card">
            <p><b>User:</b> ${d.username}</p>
            <p><b>Amount:</b> ₹${d.amount}</p>
            <p><b>UTR:</b> ${d.utr}</p>
            <div class="btns">
              <div class="approve"
                onclick="approvePayment('${doc.id}','${d.username}',${d.amount})">
                Approve
              </div>
              <div class="reject"
                onclick="rejectPayment('${doc.id}')">
                Reject
              </div>
            </div>
          </div>
        `;
      });
    });
}

/* ================= APPROVE PAYMENT ================= */
function approvePayment(paymentId, username, amount){
  db.collection("users")
    .where("username","==",username)
    .limit(1)
    .get()
    .then(snapshot=>{
      if(snapshot.empty){
        alert("User not found");
        return;
      }

      snapshot.forEach(userDoc=>{
        const oldWallet = userDoc.data().wallet || 0;

        // UPDATE USER WALLET
        db.collection("users").doc(userDoc.id).update({
          wallet: oldWallet + amount
        });
      });

      // UPDATE PAYMENT STATUS
      db.collection("payments").doc(paymentId).update({
        status: "approved"
      });

      alert("Payment approved & wallet updated");
    });
}

/* ================= REJECT PAYMENT ================= */
function rejectPayment(paymentId){
  db.collection("payments").doc(paymentId).update({
    status: "rejected"
  });
  alert("Payment rejected");
}
</script>

</body>
</html>